<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Tree Example</title>


		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
		<!-- load the d3.js library -->
		<script src="http://d3js.org/d3.v3.min.js"></script>

		<script src="https://d3js.org/d3-color.v1.min.js"></script>
		<script src="https://d3js.org/d3-dispatch.v1.min.js"></script>
		<script src="https://d3js.org/d3-ease.v1.min.js"></script>
		<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
		<script src="https://d3js.org/d3-selection.v1.min.js"></script>
		<script src="https://d3js.org/d3-timer.v1.min.js"></script>
		<script src="https://d3js.org/d3-transition.v1.min.js"></script>
		<script src="https://d3js.org/d3-drag.v1.min.js"></script>
		<script src="https://d3js.org/d3-zoom.v1.min.js"></script>

		<script src="https://d3js.org/d3-fetch.v1.min.js"></script>

		<style>
		.node {
			fill: #ccc;
			stroke: #fff;
			stroke-width: 2px;
		}
		.link {
			stroke: #777;
			stroke-width: 2px;
		}
	</style>
</head>

<body>
	<script>
		var width = window.innerWidth || document.body.clientWidth,
			height = window.innerHeight || document.body.clientHeight;

		// TODO: post request to send w and h back to model

		var nodes;
		$.getJSON('http://localhost:8080/api/nodes', function(json) {
			nodes = json;
		}).then(function() {
			console.log("nodes");
			console.log(nodes);
		});

		var edges;
		$.getJSON('http://localhost:8080/api/edges', function(data) {
			edges = JSON.parse(JSON.stringify(data));
		}).then(plot);

		// var nodeJson = "{{node_coords}}";
		// var edgeJson = "{{edge_coords}}";
		// var nodes = JSON.parse(nodeJson.replace(/(&quot\;)/g, '"'));
		// var edges = JSON.parse(edgeJson.replace(/(&quot\;)/g, '"'));

		function plot() {
			var svg = d3.select("body")
			.append("svg")
			.attr("width", width)
			.attr("height", height)
			.on('click', clickTest);

			svg.call(d3.zoom()
				.scaleExtent([1 / 2, 1000])
				// .translateExtent([[0,0],[width, height]])
				.on("zoom", zoomed));

			var line = svg.selectAll("line")
			.data(edges)
			.enter().append("line")
			.attr("x1", function(d) {return d.px; })
			.attr("y1", function(d) {return d.py })
			.attr("x2", function(d) {return d.x })
			.attr("y2", function(d) {return d.y })
			.attr("stroke", "gray")
			.attr("stroke-width", 0.5);

			// var circle = svg.selectAll("circle")
			// .data(nodes)
			// .enter().append("circle")
			// .attr("cx", function(d) { return d.x; })
			// .attr("cy", function(d) { return d.y; })
			// .attr("r",function(d) { return 10; });
		}

		function clickTest() {
			console.log("click received at (" + d3.event.x + "," + d3.event.y + ")");
		}

		function zoomed() {
			console.log("k " + d3.event.transform.k);
			console.log("x " + d3.event.transform.x);
			console.log("y " + d3.event.transform.y);
		//     context.save();
		//     context.clearRect(0, 0, width, height);
		//     context.translate(d3.event.transform.x, d3.event.transform.y);
		//     context.scale(d3.event.transform.k, d3.event.transform.k);
		// 	context.restore();
		}

		</script>
	</body>
	</html>
